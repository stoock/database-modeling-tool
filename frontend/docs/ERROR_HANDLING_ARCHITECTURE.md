# 에러 처리 아키텍처

## 시스템 구조

```
┌─────────────────────────────────────────────────────────────────┐
│                         Application                              │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                    ErrorBoundary                          │  │
│  │  (React 컴포넌트 에러 캐치)                                 │  │
│  │  ┌─────────────────────────────────────────────────────┐  │  │
│  │  │                  BrowserRouter                      │  │  │
│  │  │  ┌───────────────────────────────────────────────┐  │  │  │
│  │  │  │              Routes & Pages                   │  │  │  │
│  │  │  │                                               │  │  │  │
│  │  │  │  ┌─────────────────────────────────────────┐  │  │  │  │
│  │  │  │  │        Component Tree                   │  │  │  │  │
│  │  │  │  │                                         │  │  │  │  │
│  │  │  │  │  API Calls → Axios Interceptor         │  │  │  │  │
│  │  │  │  │              ↓                          │  │  │  │  │
│  │  │  │  │         errorHandler.ts                 │  │  │  │  │
│  │  │  │  │              ↓                          │  │  │  │  │
│  │  │  │  │         toastStore                      │  │  │  │  │
│  │  │  │  └─────────────────────────────────────────┘  │  │  │  │
│  │  │  └───────────────────────────────────────────────┘  │  │  │
│  │  │                                                      │  │  │
│  │  │  ┌───────────────────────────────────────────────┐  │  │  │
│  │  │  │              Toaster                          │  │  │  │
│  │  │  │  (Toast 메시지 표시)                           │  │  │  │
│  │  │  └───────────────────────────────────────────────┘  │  │  │
│  │  │                                                      │  │  │
│  │  │  ┌───────────────────────────────────────────────┐  │  │  │
│  │  │  │          NetworkStatus                        │  │  │  │
│  │  │  │  (네트워크 상태 모니터링)                       │  │  │  │
│  │  │  └───────────────────────────────────────────────┘  │  │  │
│  │  └─────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

## 에러 처리 흐름

### 1. API 에러 처리 흐름

```
┌──────────────┐
│ API 호출     │
│ (axios)      │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ 에러 발생    │
└──────┬───────┘
       │
       ▼
┌──────────────────────┐
│ Axios Interceptor    │
│ (response error)     │
└──────┬───────────────┘
       │
       ▼
┌──────────────────────┐
│ parseAxiosError()    │
│ - 에러 타입 식별     │
│ - 상태 코드 매핑     │
│ - 메시지 추출        │
└──────┬───────────────┘
       │
       ▼
┌──────────────────────┐
│ logError()           │
│ (개발 환경만)        │
└──────┬───────────────┘
       │
       ▼
┌──────────────────────┐
│ getUserFriendly      │
│ Message()            │
│ - 검증 에러 포맷     │
│ - 재시도 안내 추가   │
└──────┬───────────────┘
       │
       ▼
┌──────────────────────┐
│ toastStore.error()   │
│ - 토스트 표시        │
└──────────────────────┘
```

### 2. React 컴포넌트 에러 처리 흐름

```
┌──────────────────┐
│ 컴포넌트 에러    │
│ (렌더링/라이프   │
│  사이클)         │
└──────┬───────────┘
       │
       ▼
┌──────────────────────┐
│ ErrorBoundary        │
│ componentDidCatch()  │
└──────┬───────────────┘
       │
       ▼
┌──────────────────────┐
│ 에러 로깅            │
│ (개발 환경)          │
└──────┬───────────────┘
       │
       ▼
┌──────────────────────┐
│ 폴백 UI 표시         │
│ - 에러 아이콘        │
│ - 에러 메시지        │
│ - 복구 버튼          │
└──────────────────────┘
```

### 3. 네트워크 상태 변경 흐름

```
┌──────────────────┐
│ 네트워크 상태    │
│ 변경 감지        │
│ (online/offline) │
└──────┬───────────┘
       │
       ▼
┌──────────────────────┐
│ NetworkStatus        │
│ useEffect()          │
└──────┬───────────────┘
       │
       ├─────────────────┐
       │                 │
       ▼                 ▼
┌──────────────┐  ┌──────────────┐
│ 오프라인     │  │ 온라인       │
└──────┬───────┘  └──────┬───────┘
       │                 │
       ▼                 ▼
┌──────────────┐  ┌──────────────┐
│ warning()    │  │ success()    │
│ 토스트       │  │ 토스트       │
└──────┬───────┘  └──────┬───────┘
       │                 │
       ▼                 ▼
┌──────────────┐  ┌──────────────┐
│ 배지 표시    │  │ 배지 숨김    │
└──────────────┘  └──────────────┘
```

## 컴포넌트 관계도

```
┌─────────────────────────────────────────────────────────────┐
│                         App.tsx                              │
│  ┌───────────────────────────────────────────────────────┐  │
│  │                  ErrorBoundary                        │  │
│  │  - React 에러 캐치                                     │  │
│  │  - 폴백 UI 표시                                        │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                              │
│  ┌───────────────────────────────────────────────────────┐  │
│  │                    Toaster                            │  │
│  │  - Toast 메시지 렌더링                                 │  │
│  │  - 4가지 변형 지원                                     │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                              │
│  ┌───────────────────────────────────────────────────────┐  │
│  │                 NetworkStatus                         │  │
│  │  - 네트워크 상태 감지                                  │  │
│  │  - 오프라인 배지 표시                                  │  │
│  └───────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## 상태 관리

```
┌─────────────────────────────────────────────────────────────┐
│                      toastStore (Zustand)                    │
│  ┌───────────────────────────────────────────────────────┐  │
│  │  State:                                               │  │
│  │  - toasts: ToastMessage[]                            │  │
│  │                                                       │  │
│  │  Actions:                                            │  │
│  │  - addToast(toast)                                   │  │
│  │  - removeToast(id)                                   │  │
│  │  - clearAll()                                        │  │
│  │  - success(title, description)                       │  │
│  │  - error(title, description)                         │  │
│  │  - warning(title, description)                       │  │
│  │  - info(title, description)                          │  │
│  └───────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## 에러 타입 계층

```
ErrorType
├── NETWORK (재시도 가능)
│   └── 네트워크 연결 오류
├── TIMEOUT (재시도 가능)
│   └── 요청 시간 초과
├── SERVER (재시도 가능)
│   ├── 500: 서버 오류
│   ├── 502: 게이트웨이 오류
│   └── 503: 서비스 이용 불가
├── VALIDATION
│   ├── 400: 잘못된 요청
│   └── 422: 검증 실패
├── NOT_FOUND
│   └── 404: 리소스 없음
├── CONFLICT
│   └── 409: 중복 데이터
├── UNAUTHORIZED
│   └── 401: 인증 필요
├── FORBIDDEN
│   └── 403: 접근 거부
└── UNKNOWN
    └── 알 수 없는 오류
```

## 훅 사용 패턴

### useAsyncError

```typescript
┌─────────────────────┐
│  useAsyncError()    │
│  ↓                  │
│  handleError        │
│  ↓                  │
│  parseError()       │
│  ↓                  │
│  logError()         │
│  ↓                  │
│  getUserFriendly    │
│  Message()          │
│  ↓                  │
│  showError()        │
└─────────────────────┘
```

### useAsyncWrapper

```typescript
┌─────────────────────┐
│ useAsyncWrapper()   │
│  ↓                  │
│  wrapAsync          │
│  ↓                  │
│  try {              │
│    asyncFn()        │
│  } catch (error) {  │
│    onError?()       │
│    handleError()    │
│  }                  │
└─────────────────────┘
```

### useNetworkStatus

```typescript
┌─────────────────────┐
│ useNetworkStatus()  │
│  ↓                  │
│  useState(online)   │
│  ↓                  │
│  useEffect(() => {  │
│    addEventListener │
│    ('online')       │
│    addEventListener │
│    ('offline')      │
│  })                 │
│  ↓                  │
│  return isOnline    │
└─────────────────────┘
```

## Toast 변형 시각화

```
┌─────────────────────────────────────────────────────────────┐
│ default (회색)                                               │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ ℹ️  알림                                          [X]    │ │
│ │ 새로운 업데이트가 있습니다                               │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ success (초록색)                                             │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ ✓  성공                                           [X]    │ │
│ │ 작업이 완료되었습니다                                    │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ warning (노란색)                                             │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ ⚠️  경고                                          [X]    │ │
│ │ 이 작업은 되돌릴 수 없습니다                             │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ destructive (빨간색)                                         │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ ✕  오류                                           [X]    │ │
│ │ 작업 실행 중 오류가 발생했습니다                         │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

## 에러 처리 레이어

```
┌─────────────────────────────────────────────────────────────┐
│ Layer 1: React Error Boundary                                │
│ - 컴포넌트 렌더링 에러                                        │
│ - 라이프사이클 에러                                           │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│ Layer 2: API Interceptor                                     │
│ - HTTP 요청/응답 에러                                         │
│ - 네트워크 에러                                               │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│ Layer 3: Error Handler                                       │
│ - 에러 파싱 및 변환                                           │
│ - 타입 식별                                                   │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│ Layer 4: Toast Store                                         │
│ - 사용자에게 메시지 표시                                      │
│ - 자동 제거                                                   │
└─────────────────────────────────────────────────────────────┘
```

## 개발 vs 프로덕션

### 개발 환경
```
에러 발생
  ↓
콘솔 로깅 (상세)
  ├─ 에러 타입
  ├─ 메시지
  ├─ 상태 코드
  ├─ 상세 정보
  └─ 원본 에러
  ↓
토스트 표시
  ↓
ErrorBoundary (상세 정보 표시)
```

### 프로덕션 환경
```
에러 발생
  ↓
에러 리포팅 서비스
(Sentry, LogRocket 등)
  ↓
토스트 표시
  ↓
ErrorBoundary (간단한 메시지)
```
